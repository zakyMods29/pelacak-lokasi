<!DOCTYPE html>
<html>
<head>
    <title>Track Lokasi (Izin Pasangan)</title>
</head>
<body>
    <h2>Klik tombol di bawah untuk kirim lokasi ke saya</h2>
    <button onclick="getLocation()">Bagikan Lokasi Saya</button>
    <p id="display"></p>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getDatabase, ref, set } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDduehtEZ1LZY5deabAnSzH5eBDQUMb9kQ",
            authDomain: "aplikasi-pelacak-5ae31.firebaseapp.com",
            databaseURL: "https://aplikasi-pelacak-5ae31-default-rtdb.asia-south1.firebasedatabase.app",
            projectId: "aplikasi-pelacak-5ae31",
            storageBucket: "aplikasi-pelacak-5ae31.firebasestorage.app",
            messagingSenderId: "86583141131",
            appId: "1:86583141131:web:6e795b2228da1c32a6780e"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);

        window.getLocation = function() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(sendData);
            } else {
                alert("Geolocation tidak didukung.");
            }
        }

        function sendData(position) {
    const lat = position.coords.latitude;
    const lon = position.coords.longitude;
    const nomorWA = "6283166311396"; 
    const tokenFonnte = "FppCnGYZuSjJzmp9LCq8";

    document.getElementById("display").innerHTML = "Sedang mengirim lokasi...";

    // A. SIMPAN KE FIREBASE
    set(ref(database, 'lokasi/user1'), {
        latitude: lat,
        longitude: lon,
        timestamp: new Date().getTime()
    });

    // B. KIRIM OTOMATIS KE WHATSAPP VIA FONNTE
    const pesan = `⚠️ *LOKASI TERDETEKSI* ⚠️\n\nLat: ${lat}\nLon: ${lon}\nCek di Peta: https://www.google.com/maps?q=${lat},${lon}`;
    
    const formData = new FormData();
    formData.append('target', nomorWA);
    formData.append('message', pesan);

    fetch('https://api.fonnte.com/send', {
        method: 'POST',
        headers: {
            'Authorization': tokenFonnte
        },
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        document.getElementById("display").innerHTML = "Lokasi terkirim otomatis ke WhatsApp!";
    })
    .catch(err => {
        console.error(err);
        // Jika API otomatis gagal, gunakan cara manual sebagai cadangan
        window.open(`https://wa.me/${nomorWA}?text=${encodeURIComponent(pesan)}`, '_blank');
    });
        }
